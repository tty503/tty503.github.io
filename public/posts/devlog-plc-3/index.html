<!DOCTYPE html>
<html lang="es-ve"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="content-type" content="text/html">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title itemprop="name">DevLog : AWL, Arquitectura Interna, La Transición S5 a S7 y la Máquina Virtual MC7 | tty503</title>
<meta property="og:title" content="DevLog : AWL, Arquitectura Interna, La Transición S5 a S7 y la Máquina Virtual MC7 | tty503" />
<meta name="twitter:title" content="DevLog : AWL, Arquitectura Interna, La Transición S5 a S7 y la Máquina Virtual MC7 | tty503" />
<meta itemprop="name" content="DevLog : AWL, Arquitectura Interna, La Transición S5 a S7 y la Máquina Virtual MC7 | tty503" />
<meta name="application-name" content="DevLog : AWL, Arquitectura Interna, La Transición S5 a S7 y la Máquina Virtual MC7 | tty503" />
<meta property="og:site_name" content="" />

<meta name="description" content="">
<meta itemprop="description" content="" />
<meta property="og:description" content="" />
<meta name="twitter:description" content="" />

<meta property="og:locale" content="es-ve" />
<meta name="language" content="es-ve" />

  <link rel="alternate" hreflang="en" href="http://localhost:1313/posts/devlog-plc-3/" title="" />





    
    
    

    <meta property="og:type" content="article" />
    <meta property="og:article:published_time" content=2025-04-27T00:00:00Z />
    <meta property="article:published_time" content=2025-04-27T00:00:00Z />
    <meta property="og:url" content="http://localhost:1313/posts/devlog-plc-3/" />

    
    <meta property="og:article:author" content="Christian Marquez" />
    <meta property="article:author" content="Christian Marquez" />
    <meta name="author" content="Christian Marquez" />
    
    

    

    <script defer type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "Article",
        "headline": "DevLog : AWL, Arquitectura Interna, La Transición S5 a S7 y la Máquina Virtual MC7",
        "author": {
        "@type": "Person",
        "name": ""
        },
        "datePublished": "2025-04-27",
        "description": "",
        "wordCount":  320 ,
        "mainEntityOfPage": "True",
        "dateModified": "2025-04-27",
        "image": {
        "@type": "imageObject",
        "url": ""
        },
        "publisher": {
        "@type": "Organization",
        "name": "tty503"
        }
    }
    </script>


<meta name="generator" content="Hugo 0.150.0">

    
    <meta property="og:url" content="http://localhost:1313/posts/devlog-plc-3/">
  <meta property="og:site_name" content="tty503">
  <meta property="og:title" content="DevLog : AWL, Arquitectura Interna, La Transición S5 a S7 y la Máquina Virtual MC7">
  <meta property="og:description" content="De 16 a 32 Bits La transición de la familia S5 a la S7 (S7-300/400 y posteriores) no fue meramente estética o de software. Fue un cambio fundamental de arquitectura que introdujo capas de abstracción complejas, dificultando el análisis de bajo nivel.
La Máquina Virtual MC7 Quizás el hallazgo más importante para el investigador de seguridad es este: En los PLCs modernos Siemens, el código que escribes NO se ejecuta directamente en el procesador.">
  <meta property="og:locale" content="es_ve">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-04-27T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-04-27T00:00:00+00:00">
    <meta property="article:tag" content="ICS Security">
    <meta property="article:tag" content="Siemens S5">
    <meta property="article:tag" content="AWL">
    <meta property="article:tag" content="Assembly">
    <meta property="article:tag" content="Reverse Engineering">
    <meta property="article:tag" content="Stuxnet">


    
    
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="DevLog : AWL, Arquitectura Interna, La Transición S5 a S7 y la Máquina Virtual MC7">
  <meta name="twitter:description" content="De 16 a 32 Bits La transición de la familia S5 a la S7 (S7-300/400 y posteriores) no fue meramente estética o de software. Fue un cambio fundamental de arquitectura que introdujo capas de abstracción complejas, dificultando el análisis de bajo nivel.
La Máquina Virtual MC7 Quizás el hallazgo más importante para el investigador de seguridad es este: En los PLCs modernos Siemens, el código que escribes NO se ejecuta directamente en el procesador.">


    

    <link rel="canonical" href="http://localhost:1313/posts/devlog-plc-3/">
    <link href="/style.min.2d921c18cf1ec555ffc03d59a8adc211c402c68c930c27d6a0c306ab175a8d09.css" rel="stylesheet">
    <link href="/code-highlight.min.706d31975fec544a864cb7f0d847a73ea55ca1df91bf495fd12a177138d807cf.css" rel="stylesheet">

    
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg">
    <link rel="shortcut icon" href="/favicon.ico">




<link rel="manifest" href="http://localhost:1313/site.webmanifest">

<meta name="msapplication-config" content="/browserconfig.xml">
<meta name="msapplication-TileColor" content="#2d89ef">
<meta name="theme-color" content="#434648">
    <meta name="color-scheme" content="light dark">

    
    <link rel="icon" type="image/svg+xml" href="/icons/favicon.svg">

    
    
</head>
<body data-theme = "" class="notransition">

<script src="/js/theme.js"></script>

<div class="navbar" role="navigation">
    <nav class="menu" aria-label="Main Navigation">
        <a href="http://localhost:1313/" class="logo">
            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" 
viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" 
stroke-linejoin="round" class="feather feather-home">
<title></title>
<path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
<polyline points="9 22 9 12 15 12 15 22"></polyline>
</svg>
        </a>
        <input type="checkbox" id="menu-trigger" class="menu-trigger" />
        <label for="menu-trigger">
            <span class="menu-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" stroke="currentColor" fill="none" viewBox="0 0 14 14"><title>Menu</title><path stroke-linecap="round" stroke-linejoin="round" d="M10.595 7L3.40726 7"></path><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 3.51488L3.49301 3.51488"></path><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 10.4851H3.49301"></path><path stroke-linecap="round" stroke-linejoin="round" d="M0.5 12.5V1.5C0.5 0.947715 0.947715 0.5 1.5 0.5H12.5C13.0523 0.5 13.5 0.947715 13.5 1.5V12.5C13.5 13.0523 13.0523 13.5 12.5 13.5H1.5C0.947715 13.5 0.5 13.0523 0.5 12.5Z"></path></svg>
            </span>
        </label>

        <div class="trigger">
            <ul class="trigger-container">
                
                
                <li>
                    <a class="menu-link " href="/">
                        Inicio
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link active" href="/posts/">
                        Blog
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link " href="/pages/about/">
                        Sobre Mi
                    </a>
                    
                </li>
                
                <li class="menu-separator">
                    <span>|</span>
                </li>
                
                
            </ul>
            <a id="mode" href="#">
                <svg xmlns="http://www.w3.org/2000/svg" class="mode-sunny" width="21" height="21" viewBox="0 0 14 14" stroke-width="1">
<title>LIGHT</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></circle><line x1="7" y1="0.5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="0.5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line></g></svg>
                <svg xmlns="http://www.w3.org/2000/svg" class="mode-moon" width="21" height="21" viewBox="0 0 14 14" stroke-width="1">
<title>DARK</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></circle><line x1="7" y1="0.5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="0.5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line></g></svg>
            </a>
        </div>
    </nav>
</div>

<div class="wrapper post">
    <main class="page-content" aria-label="Content">
        <article>
            <header class="header">
                <h1 class="header-title">DevLog : AWL, Arquitectura Interna, La Transición S5 a S7 y la Máquina Virtual MC7</h1>
                
                
                
                <div class="post-meta">
                    <time datetime="2025-04-27T00:00:00&#43;00:00" itemprop="datePublished"> Apr 27, 2025 </time>
                </div>
                
            </header>
            
            <div class="page-content">
                <h3 id="de-16-a-32-bits">De 16 a 32 Bits</h3>
<p>La transición de la familia S5 a la S7 (S7-300/400 y posteriores) no fue meramente estética o de software. Fue un cambio fundamental de arquitectura que introdujo capas de abstracción complejas, dificultando el análisis de bajo nivel.</p>
<h3 id="la-máquina-virtual-mc7">La Máquina Virtual MC7</h3>
<p>Quizás el hallazgo más importante para el investigador de seguridad es este: En los PLCs modernos Siemens, el código que escribes NO se ejecuta directamente en el procesador.</p>
<p>La arquitectura funciona en tres capas:</p>
<ul>
<li>Capa Lógica (Usuario): Código AWL/SCL/LAD.</li>
<li>Capa Intermedia (Bytecode): El código se compila a MC7, un bytecode propietario de Siemens.</li>
<li>Capa Física (Hardware): Un procesador (generalmente ARM, MIPS o un ASIC propietario) que interpreta o compila JIT (Just-In-Time) el MC7.</li>
</ul>
<p>Esto significa que cuando hacemos ingeniería inversa a un binario de S7, estamos analizando una Máquina Virtual. Esto explica por qué el set de instrucciones MC7 parece &ldquo;ajeno&rdquo; al hardware físico real del dispositivo.</p>
<img src="/post-4.jpg" alt="Diagrama de flujo: AWL -> Bytecode MC7 -> Ejecución en CPU Nativa" width="800" height="400" />
<h3 id="cambios-críticos-en-la-organización-de-memoria">Cambios Críticos en la Organización de Memoria</h3>
<table>
  <thead>
      <tr>
          <th>Característica</th>
          <th>Siemens S5</th>
          <th>Siemens S7</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Ancho de palabra</td>
          <td>16-bits</td>
          <td>32-bits</td>
      </tr>
      <tr>
          <td>Acumuladores</td>
          <td>2 (AKKU1-AKKU2)</td>
          <td>2 o 4 (ACU1-ACU4)</td>
      </tr>
      <tr>
          <td>Datos Locales</td>
          <td>No existe</td>
          <td>Stack Local (&lsquo;L&rsquo;)</td>
      </tr>
      <tr>
          <td>Bloques de Datos</td>
          <td>DB, DX</td>
          <td>DB Globales y DB de Instancia (DI)</td>
      </tr>
  </tbody>
</table>
<h3 id="bloques-de-datos-db">Bloques de Datos (DB)</h3>
<p>En S5, los datos se almacenaban de forma plana (DW 0, DW 1&hellip;). En S7, el direccionamiento se vuelve orientado a Bytes (DBB, DBW, DBD).</p>
<p>Una diferencia clave es el DB de Instancia. Mientras que un DB global es accesible por cualquiera, un DI está atado a una llamada de función específica (FB). Esto crea un encapsulamiento que, si bien mejora la programación, obliga al atacante a entender el contexto de ejecución para inyectar datos exitosamente sin corromper el proceso.</p>
<img src="/post-3.jpg" alt="Comparativa de Hexdump vs Visualización en WinSPS" width="800" height="400" />
<p>El análisis estático de estos bloques (como se ve en la imagen superior con herramientas como Rizin o hexdumps crudos) revela que el formato del archivo .wld (World) que es el resultado de intentar exportar el formato compilado en WinSPS.</p>

            </div>
        </article></main>
</div>
<footer class="footer">
    <span class="footer_item"> </span>
    &nbsp;

    <div class="footer_social-icons">
<a href="https://linkedin.com/in/tty503" target="_blank" rel="noopener noreferrer me"
    title="Linkedin">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path>
    <rect x="2" y="9" width="4" height="12"></rect>
    <circle cx="4" cy="4" r="2"></circle>
</svg>
</a>
<a href="https://github.com/tty503" target="_blank" rel="noopener noreferrer me"
    title="Github">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path
        d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22">
    </path>
</svg>
</a>
<a href="https://x.com/tty_503" target="_blank" rel="noopener noreferrer me"
    title="Twitter">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path
        d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z">
    </path>
</svg>
</a>
<a href="https://t.me/tty503" target="_blank" rel="noopener noreferrer me"
    title="Telegram">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path
        d="M21.198 2.433a2.242 2.242 0 0 0-1.022.215l-8.609 3.33c-2.068.8-4.133 1.598-5.724 2.21a405.15 405.15 0 0 1-2.849 1.09c-.42.147-.99.332-1.473.901-.728.968.193 1.798.919 2.286 1.61.516 3.275 1.009 4.654 1.472.509 1.793.997 3.592 1.48 5.388.16.36.506.494.864.498l-.002.018s.281.028.555-.038a2.1 2.1 0 0 0 .933-.517c.345-.324 1.28-1.244 1.811-1.764l3.999 2.952.032.018s.442.311 1.09.355c.324.022.75-.04 1.116-.308.37-.27.613-.702.728-1.196.342-1.492 2.61-12.285 2.997-14.072l-.01.042c.27-1.006.17-1.928-.455-2.474a1.654 1.654 0 0 0-1.034-.407z" />
</svg>
</a>
</div>
    <small class="footer_copyright">
        © 2025 Christian Marquez.
        
    </small>
</footer><a href="#" title="" id="totop">
    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" stroke="currentColor" viewBox="0 96 960 960">
    <path d="M283 704.739 234.261 656 480 410.261 725.739 656 677 704.739l-197-197-197 197Z"/>
</svg>

</a>


    






    
    <script async src="http://localhost:1313/js/main.js" ></script>

    

</body>
</html>
